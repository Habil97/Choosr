@model Choosr.Web.ViewModels.LeaderboardViewModel
@{
  ViewData["Title"] = $"Global Oluşturucu Liderliği ({Model.Period})";
}

<section class="layout-container py-4">
  <div class="text-center">
    <div class="mb-2" style="color:#ffd54a;font-weight:900;letter-spacing:.06em;text-transform:uppercase;">Liderlik</div>
    <h1 class="mb-2" style="font-weight:800;">Global Oluşturucu Liderliği</h1>

    <div class="d-flex justify-content-center gap-2 mb-3 flex-wrap">
      <div class="btn-group" role="group" aria-label="Periyot">
        <a class="btn btn-sm @(Model.Period=="Haftalık"?"btn-warning text-dark":"btn-outline-secondary")" asp-controller="Leaderboard" asp-action="Creators" asp-route-period="week" asp-route-metric="@(Model.Metric=="Tekil Oyuncu"?"unique":"plays")" asp-route-category="@Model.Category">🗓️ Haftalık</a>
        <a class="btn btn-sm @(Model.Period=="Aylık"?"btn-warning text-dark":"btn-outline-secondary")" asp-controller="Leaderboard" asp-action="Creators" asp-route-period="month" asp-route-metric="@(Model.Metric=="Tekil Oyuncu"?"unique":"plays")" asp-route-category="@Model.Category">🗓️ Aylık</a>
      </div>
      <div class="btn-group" role="group" aria-label="Metrik">
        <a class="btn btn-sm @(Model.Metric=="Toplam Oyun"?"btn-warning text-dark":"btn-outline-secondary")" asp-controller="Leaderboard" asp-action="Creators" asp-route-period="@(Model.Period=="Aylık"?"month":"week")" asp-route-metric="plays" asp-route-category="@Model.Category">🎮 Toplam Oyun</a>
        <a class="btn btn-sm @(Model.Metric=="Tekil Oyuncu"?"btn-warning text-dark":"btn-outline-secondary")" asp-controller="Leaderboard" asp-action="Creators" asp-route-period="@(Model.Period=="Aylık"?"month":"week")" asp-route-metric="unique" asp-route-category="@Model.Category">👥 Tekil Oyuncu</a>
      </div>
      <form method="get" asp-controller="Leaderboard" asp-action="Creators" class="d-inline-flex align-items-center gap-2">
        <input type="hidden" name="period" value="@(Model.Period=="Aylık"?"month":"week")" />
        <input type="hidden" name="metric" value="@(Model.Metric=="Tekil Oyuncu"?"unique":"plays")" />
        <select name="category" class="form-select form-select-sm" style="min-width:200px;" onchange="this.form.submit()">
          <option value="" selected="@(string.IsNullOrWhiteSpace(Model.Category) ? "selected" : null)">Tüm Kategoriler</option>
          @foreach(var c in Model.Categories){
            <option value="@c" selected="@(string.Equals(Model.Category, c, System.StringComparison.OrdinalIgnoreCase) ? "selected" : null)">@c</option>
          }
        </select>
        <button type="submit" class="btn btn-sm btn-outline-secondary">Filtrele</button>
        @if(!string.IsNullOrWhiteSpace(Model.Category)){
          <a class="btn btn-sm btn-outline-danger" asp-controller="Leaderboard" asp-action="Creators" asp-route-period="@(Model.Period=="Aylık"?"month":"week")" asp-route-metric="@(Model.Metric=="Tekil Oyuncu"?"unique":"plays")">Temizle</a>
        }
      </form>
    </div>
    <div class="mx-auto mb-2" style="max-width:880px;">
      <div class="alert alert-dark border rounded-3" style="background:rgba(255,255,255,.04);border-color:rgba(255,255,255,.12)!important;color:#fff;">
        <div class="d-flex align-items-start gap-2">
          <div class="fs-5" aria-hidden="true">📘</div>
          <div class="flex-grow-1">
            <div class="fw-semibold mb-1">Liderlik mantığı</div>
            <div>Anonim oynanışlar dahil edilmez, oluşturucunun kendi oynanışları (self‑play) hariç tutulur ve sadece herkese açık quizler sayılır.</div>
          </div>
        </div>
      </div>
    </div>
    <div class="text-center mb-2" style="color:#fff;">
      <span class="me-3">🎮 Toplam Oyun: tüm oyun seansları</span>
      <span>👥 Tekil Oyuncu: farklı oyuncu sayısı</span>
    </div>
    <div class="mb-3 text-center d-flex justify-content-center gap-2 flex-wrap">
      <span class="badge rounded-pill bg-secondary">@Model.Period</span>
      <span class="badge rounded-pill bg-secondary">@Model.Metric</span>
      @if(!string.IsNullOrWhiteSpace(Model.Category)){
        <a class="badge rounded-pill bg-info text-dark text-decoration-none" title="Kategoriyi temizle" asp-controller="Leaderboard" asp-action="Creators" asp-route-period="@(Model.Period=="Aylık"?"month":"week")" asp-route-metric="@(Model.Metric=="Tekil Oyuncu"?"unique":"plays")">
          Kategori: @Model.Category ×
        </a>
      }
    </div>

    <div class="card bg-dark text-light mx-auto" style="max-width:820px;border:1px solid rgba(255,255,255,.08);">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-dark table-hover mb-0 align-middle">
            <thead>
              <tr>
                <th style="width:64px;">#</th>
                <th>Oluşturucu</th>
                <th class="text-end">Oyun</th>
              </tr>
            </thead>
            <tbody>
              @if(Model.Entries.Count == 0){
                <tr><td colspan="3" class="text-center text-muted py-4">Henüz veri yok.</td></tr>
              } else {
                var rank = 1;
                foreach(var e in Model.Entries){
                  var idx = rank;
                  string? medal = idx == 1 ? "🥇" : idx == 2 ? "🥈" : idx == 3 ? "🥉" : null;
                  string rowStyle = idx == 1 ? "background:linear-gradient(90deg, rgba(255,215,0,.08), transparent);" : idx == 2 ? "background:linear-gradient(90deg, rgba(192,192,192,.08), transparent);" : idx == 3 ? "background:linear-gradient(90deg, rgba(205,127,50,.08), transparent);" : string.Empty;
                  <tr style="@rowStyle">
                    <td class="fw-bold">
                      @if(medal != null){ <span>@medal</span> } <span>#@idx</span>
                    </td>
                    <td>
                      <div class="d-flex align-items-center gap-2">
                        <a class="d-inline-flex align-items-center gap-2 text-decoration-none" asp-controller="PublicProfile" asp-action="Show" asp-route-userName="@e.UserName">
                          <span class="avatar-thumb"><img src="@(string.IsNullOrWhiteSpace(e.AvatarUrl)?"/favicon.ico":e.AvatarUrl)" alt="" style="width:24px;height:24px;border-radius:50%;object-fit:cover;"/></span>
                          <span>@(string.IsNullOrWhiteSpace(e.DisplayName) ? e.UserName : e.DisplayName)</span>
                        </a>
                      </div>
                    </td>
                    <td class="text-end">
                      <span class="badge bg-warning text-dark" style="font-size:.95rem;">@e.Plays</span>
                    </td>
                  </tr>
                  rank++;
                }
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="text-center mt-3">
      <a class="btn btn-sm btn-outline-secondary" asp-controller="Leaderboard" asp-action="Creators" asp-route-period="@(Model.Period=="Aylık"?"month":"week")" asp-route-metric="@(Model.Metric=="Tekil Oyuncu"?"unique":"plays")" asp-route-category="@Model.Category" asp-route-top="@(Model.Top+20)">Daha Fazla</a>
    </div>
  </div>
</section>
